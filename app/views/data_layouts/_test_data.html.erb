<% data.each_with_index do |(test,value),index| %>
    <div class="contents">
        <div class="main">
            <div class="row">
                <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">
                    <div>
                        <%= value.test_label %><br/>
                        <% value.grades.each do |grade,value| %>
                            <br/>GRADE <%= grade %><br/><br/>
                            <% value.each do |levelcode,value| %>
                                <% value.each do |subject,value| %>
                                    <%= subject %><br/>
                                    <% value.each do |year,value| %>
                                        <%= year %>
                                        score : <%= value["score"] %>
                                        number tested: <%= value["number_tested"] %><br/>
                                    <% end %>

                                    <!--TODO change this to test id-->
                                    <% bar_chart_div_id = "js_bar_chart_div_#{test.gsub(/\s/,'')}_#{grade}_#{subject.gsub(/\s/,'')}" %>
                                    <div id="<%= bar_chart_div_id %>" style="width: 420px; height: 150px;"></div>
                                    <% content_for :head do %>
                                        <script type="text/javascript">
                                            GS.visualchart.drawBarChart(<%= raw (to_bar_chart_array value).to_s %>,<%= raw '"'+bar_chart_div_id+'"' %>);
                                        </script>
                                    <% end %>
                                <% end %>
                            <% end %>
                        <% end %>
                        <br/>
                    </div>
                </div>
            </div>
        </div>
    </div>
<% end %>