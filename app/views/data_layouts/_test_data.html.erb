<% data.each_with_index do |(test,value),index| %>
    <div class="contents">
        <div class="main">
            <div class="row">
                <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3">

                    <%= value.test_label %><br/><br/>
                    <div class="js_grades_div">
                        <% value.grades.each do |grade,value| %>
                            <span id="js_<%= test %>_<%= grade %>" class="js_test_scores_grades">GRADE <%= grade %></span>
                        <% end %>
                    </div>

                    <% value.grades.each do |grade,value| %>
                        <div id="js_<%= test %>_<%= grade %>_scores" class="js_<%= test %>_grades">

                            <% value.each do |levelcode,value| %>
                                <% value.each do |subject,value| %>
                                    <div><%= subject %></div>
                                    <!--TODO change this to test id-->
                                    <% bar_chart_div_id = "js_bar_chart_div_#{test.gsub(/\s/,'')}_#{grade}_#{subject.gsub(/\s/,'')}" %>
                                    <div id="<%= bar_chart_div_id %>"><!--Div for bar chart--></div>
                                    <% content_for :head do %>
                                        <script type="text/javascript">
                                            GS.visualchart.drawBarChart(<%= raw (to_bar_chart_array value).to_s %>,<%= raw '"'+bar_chart_div_id+'"' %>);
                                        </script>
                                    <% end %>
                                <% end %>
                            <% end %>
                        </div>
                    <% end %>
                </div>
            </div>
        </div>
    </div>
<% end %>


<script type="text/javascript">
    GS.testScores.initializeHandlers();
    $(".js_grades_div").children().first().trigger( "click" );
</script>