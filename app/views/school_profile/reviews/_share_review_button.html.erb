<% review %>

<% review_url_twitter = school_reviews_url(review.school, review_id: review.id, utm_source: 'Twitter', utm_medium: 'social', utm_campaign: 'Review_Share', anchor: "review#{review.id}") %>
<% review_url_email = school_reviews_url(review.school, zreview_id: review.id, utm_source: 'Email_Share', utm_medium: 'email', utm_campaign: 'Review_Share', anchor: "review#{review.id}") %>
<% review_url_facebook= school_reviews_url(review.school, review_id: review.id, utm_source: 'Facebook', utm_medium: 'social', utm_campaign: 'Review_Share', anchor: "review#{review.id}") %>

<% mailto_subject = 'Check out this review I found on GreatSchools' %>
<% mailto_body = "Hey, I found this review about #{url_encode(review.school.name)} and thought it was helpful. Hope you like it:%0A#{url_encode(review_url_email)}%0A%0A\"#{url_encode(review.comment)}\"" %>
<% mailto_params =
 {
   subject: mailto_subject,
   body: mailto_body
 }
%>
<% mailto_query_string = mailto_params.each_with_object([]){ |(k,v), array| array << "#{k}=#{v}" }.join('&') %>
<% mailto_href = "mailto:?#{mailto_query_string}" %>

<% twitter_href_params =
     {
       url: review_url_twitter,
       text: "Check out this review about #{review.school.name}"
     }
%>
<% twitter_href = "https://twitter.com/intent/tweet?#{twitter_href_params.to_param}" %>

<div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle mrm phm pvs js-gaClick" 
    data-ga-click-category='profile interactions - reviews'
    data-ga-click-action='share review'
    data-ga-click-label='Share button'
    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <span class="iconx16 i-16-fax mt3"></span>
  </button>
  <ul class="dropdown-menu">
    <p class="tac">Share</p>
    <li>
      <a class="js_shareFacebook js-gaClick pointer"
         data-ga-click-category='profile interactions - reviews'
         data-ga-click-action='share review'
         data-ga-click-label='Facebook'
         data-review-url="<%= review_url_facebook %>"
         data-review-school-name="<%= review.school.name %>"
         data-review-comment="<%= review.comment %>"
         data-review-share-image="<%= image_url("share_review.png") %>">
        On Facebook
      </a>
    </li>
    <li>
    <a class="js-gaClick" href="<%= twitter_href %>"
         data-ga-click-category='profile interactions - reviews'
         data-ga-click-action='share review'
         data-ga-click-label='Twitter' >
         On Twitter
       </a>
    </li>
    <li>
    <a class="js-gaClick" href="<%= mailto_href %>"
         data-ga-click-category='profile interactions - reviews'
         data-ga-click-action='share review'
         data-ga-click-label='Email' >
        Via Email</a>
    </li>
  </ul>
</div>
