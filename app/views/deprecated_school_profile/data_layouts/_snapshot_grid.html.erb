<% category_placement # The +CategoryPlacement+ that is configured to use this group layout %>

<%
  collections_to_hide = [*category_placement.layout_config_json['hide_module_for_collections']]
  should_hide_partial = (@school.collection_ids & collections_to_hide).present?
%>

<% unless should_hide_partial %>
<% begin %>
  <% children = @page_config.category_placement_children_with_data category_placement %>
  <% if children.any? && category_placement.title.present? %>
    <!-- Need to make decision on layout based on number of elements and whether ads are on -->
    <!-- The First two elements should always be reviews and ratings -->
    <!-- Third element 'details' will only show up when there is content -->
    <!-- Fourth element 'best known for' will only show up when there is content -->

    <!--if there is an ad then layout is fixed. Lines: two items which are always there, then one and one-->

    <!--if no ad then there are 2 possible layouts-->
    <!--no details and/or no best known for then the two items stretch across the first line and are centered-->
    <!--otherwise 3 across-->
    <% preschool_only = @school.preschool? %>


    <% if @show_ads %>
      <div class="row pvm phm">
        <div class="col-xs-12 col-md-8">
          <div class="row ">
    <% else %>
      <div class="row pvm phm">
    <% end %>

    <% children.each_with_index { |cp, index |  %>
      <% category_placement_content = render partial: 'category_placement', locals: {category_placement: cp} %>

        <% case index %>
         <% when 0 %>
            <% if preschool_only && !@show_ads %>
              <div class="col-md-offset-2 col-xs-12 col-sm-6 col-md-4">
                <%= category_placement_content %>
              </div>
            <% elsif !preschool_only && !@show_ads %>
              <div class="col-xs-12 col-sm-6 col-md-4">
                <%= category_placement_content %>
              </div>
            <% else %>
              <div class="col-xs-12 col-sm-6">
                <%= category_placement_content %>
              </div>
            <% end %>
          <% when 1 %>
            <% if !preschool_only && !@show_ads %>
              <div class="col-xs-12 col-sm-6 col-md-4 vdl vdr hdp">
                <%= category_placement_content %>
              </div>
            <% elsif preschool_only && !@show_ads %>
              <div class="col-xs-12 col-sm-6 col-md-4 vdl hdp">
                <%= category_placement_content %>
              </div>
            <% else %>
              <div class="col-xs-12 col-sm-6 vdl hdp">
                <%= category_placement_content %>
              </div>
            <% end %>
          <% when 2 %>
            <% if !preschool_only && !@show_ads %>
              <div class="col-xs-12 col-sm-12 col-md-4 hdp">
                <%= category_placement_content %>
              </div>
            <% else %>
              </div>
              <div class="js-alert-partnership row">
              <div class="js-icons-block col-xs-12 hdp">
                <%= category_placement_content %>
              </div>
            <% end %>
          <% else %>
            <%= category_placement_content %>
        <% end %>
    <% } %>
      <% if @show_ads %>
          </div>
        </div>
        <div class="col-xs-12 col-md-4">
          <%= render 'layouts/ad_layer', page: @ad_page_name, slot: :Snapshot, view: :desktop  %>
          <div class="ptxl visible-xs">
            <%= render 'layouts/ad_layer', page: @ad_page_name, slot: :Snapshot, view: :mobile  %>
          </div>
        </div>
      <% end %>
      </div>
  <% end %>

<% rescue => e %>
  <%= log_view_error "Something went wrong while trying to display #{category_placement.title}", e %>
  <% raise e if params[:debug] %>
<% end %>
<% end %>
