<% data # A +Hash+ that contains a state rating +Hash+ if available %>
<%= debug data if params[:debug] %>
<% category_placement # The +CategoryPlacement+ that this table is for %>
<% data_config = category_placement.layout_config_json %>
<% rating_type = (data_config || {}).fetch('rating_type', 'state') %>
<% rating_hash = data["#{rating_type}_rating"] %>

<% unless @school.state == 'CO' %>
  <% rating_hash = Array.wrap(rating_hash).first %>
<% end %>


<% if rating_hash.present? && rating_hash.is_a?(Array) && rating_hash.select {|r| r['overall_rating'] }.size > 0 %>
  <% rating_hash = rating_hash.select { |r| r['overall_rating'] } %>
  <% methodology_url = rating_hash.first['methodology_url'] %>
  <% label = rating_hash.first['label'] %>
  <% if @school.state == 'CO' %>
    <% label = 'Colorado School Grade' %>
  <% end %>
  <% description = rating_hash.first['description'] %>
  <% rating_breakdowns = rating_hash.first['rating_breakdowns'] %>

  <div class="row mbm pam">
  <div class="col-xs-12 col-sm-3 col-md-2 col-lg-2">
    <% rating_hash.each do |rh| %>
      <div class="dib tac mhs mbm small" style="width:100px">
        <div class="ma">
          <%= render(state_partial(@school.state), page:'quality', rating: rh["overall_rating"]) %>
        </div>
        <div><%= rh['label'] %></div>
      </div>
    <% end %>
    </div>
    <div class="col-xs-12 col-sm-9 col-md-10 col-lg-10"><h4><%= db_t(label) %></h4>
    <p><%= db_t(description) %></p>
      <p><a href="javascript:void(0)" class="js_toggle_parent_sib"><%= t('.learn_more_html') %></a></p>

      <% if (rating_breakdowns.present? || methodology_url.present? )%>
        <div class="dn well bg-white">
          <% if rating_breakdowns.present? %>
            <h5><%= t('.rating_breakdown') %></h5>
            <table class="table table-striped">
              <% rating_breakdowns.each do |key, value| %>
                <tr><td><%= db_t(key) %></td><td><%= value['rating'] %></td></tr>
              <% end %>
            </table>
          <% end %>
          <% if methodology_url.present? %>
            <h5><%= t('.methodology') %></h5>
            <a href="<%= methodology_url %>" target="_blank"><%= t('.view_more_details') %></a>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% elsif rating_hash.present? && rating_hash.is_a?(Hash) && rating_hash["overall_rating"].present? %>
  <div class="row mbm pam">
  <!--<% color_hash = {"Green" => "#009900", "Lime" => "#99FF66", "Yellow" => "#FFFF00", "Orange" => "#FF9900", "Red" => "#FF3300"} %>-->
  <div class="col-xs-12 col-sm-3 col-md-2 col-lg-2">
    <%= render state_partial(@school.state), page:'quality', rating: rating_hash["overall_rating"] %>
    </div>
    <div class="col-xs-12 col-sm-9 col-md-10 col-lg-10"><h4><%= db_t(rating_hash["label"]) %></h4>
    <p><%= db_t(rating_hash["description"]) %></p>
      <p><a href="javascript:void(0)" class="js_toggle_parent_sib"><%= t('.learn_more_html') %></a></p>

      <% if (rating_hash["rating_breakdowns"].present? || rating_hash["methodology_url"].present? )%>
        <div class="dn well bg-white">
          <% if rating_hash["rating_breakdowns"].present? %>
            <h5><%= t('.rating_breakdown') %></h5>
            <table class="table table-striped">
              <% rating_hash["rating_breakdowns"].each do |key, value| %>
                <tr><td><%= db_t(key) %></td><td><%= value['rating'] %></td></tr>
              <% end %>
            </table>
          <% end %>
          <% if rating_hash["methodology_url"].present? %>
            <h5><%= t('.methodology') %></h5>
            <a href="<%= rating_hash["methodology_url"] %>" target="_blank"><%= t('.view_more_details') %></a>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
