<% school_page_path = (school.try(:profile_path) || school_path(school)) %>
<% query_string = '' %>
<% query_string << "?lang=#{params[:lang]}" if params[:lang] %>
<% school_page_url = school.preschool? ? "http://#{ENV_GLOBAL['app_pk_host'] + school_page_path}" : school_page_path %>
<% school_reviews_page_url = school_page_url + 'reviews/' + query_string %>
<% school_quality_page_url = school_page_url + 'quality/' + query_string %>
<% school_page_url << query_string %>
<% school_provided_photo = decorated_school.uploaded_photo(130) %>
<% if search_by_location? %>
  <% distance = decorated_school.distance #converting to 2 decimal places %>
<% end %>
<% unless defined? account_page %>
    <% account_page = false %>
<% end %>

<% # This partial needs gs-bootstrap because accounts page aren't bootstapified yet %>
<div class="pvm gs-bootstrap js-schoolSearchResult js-schoolSearchResultCompareErrorMessage" data-schoolId="<%=school.id%>" data-schoolState="<%=school.state%>">
  <div class="clearfix search-result-border prm bg-white">
    <div class="">
      <div class="row">
        <div class="col-xs-7 col-sm-5 col-md-7 col-lg-6 clearfix school-info">
          <div class="hidden-xs hidden-sm fl js-schoolPhoto">
              <% if school_provided_photo %>
                <%= school_provided_photo %>
              <% else %>
                <img src="<%= image_path('search/no-school-photo.png')%>" alt="No school photo available" class="thumbnail-border"/>
              <% end %>
          </div>
          <div class="fl pll">
            <div class="ptm notranslate">
              <div class="mtm hidden-xs"></div>
              <div><%= link_to "#{school.name}", school_page_url, style:'line-height: 1.1em', class: 'open-sans_sb mbs font-size-medium rs-schoolName' %></div>
              <div class="hidden-xs font-size-small rs-schoolAddress"><%="#{school.street}, #{school.city}, #{school.state.upcase} #{school.zip}"%></div>
              <div class="clearfix visible-xs font-size-small">
                <div class="prs fl "><%= db_t(school_type_display(school.type)) %></div>
                <div class="fl"><%= (decorated_school.try(:grade_range) || decorated_school.process_level) %></div>
              </div>
            </div>
            <div class="font-size-small mvm clearfix ptm hidden-xs">
              <div class="fl">
                <% if !school.community_rating.nil? && !school.review_count.nil? %>
                  <span class="prm vam"><%= draw_stars_16 school.community_rating %></span>
                  <%=link_to t('.reviews', count: school.review_count), school_reviews_page_url, class: 'font-size-small js-reviewCount' %>
                <% else %>
                  <em class="js-reviewCount"><%= t('.no_reviews') %></em>
                <% end %>
              </div>
              <div class="phm fl">|</div>
              <div class="prs fl"><%= db_t(school_type_display(school.type)) %></div>
              <div class="fl"><%= (decorated_school.try(:grade_range) || decorated_school.process_level) %></div>
            </div>
          </div>
        </div>
        <div class="col-xs-5 col-sm-4 col-md-3 col-lg-4 icons">
          <div class="ptl hidden-xs"></div>
          <div class="row">
            <% if search_by_location? %>
            <!-- Distance -->
            <div class="hidden-xs col-sm-4 mtl mbm font-size-xs tac">
              <div class="iconx24-icons i-24-new-grey_map_pin ma db vam"></div>
              <span class="tac db js-distance"><%= distance %> <%= t('.miles') %></span>
            </div>
            <% end%>
            <!-- GS Rating -->
            <div class="col-xs-6 col-sm-4 mvl tac">
              <%=link_to school_quality_page_url do%>
              <div class="ma db iconx24-icons i-24-new-ratings-<%=(school.overall_gs_rating || 'nr' )%>"></div>
              <div class="hidden-xs pts"></div>
              <span class="tac font-size-xs db link-darkgray" style="line-height: 1.3em"><%= t('.greatschools_rating_html') %></span>
              <% end %>
            </div>
            <!-- Fit score -->
            <div class="col-xs-6 col-sm-4 mtl mbs js-schoolFitScore">
              <% if filtering_search? %>
                  <%= render 'fit_score_icon_and_popup', school: school, decorated_school: decorated_school %>
              <% end %>
            </div>
          </div>
        </div>
        <!-- do not show on account page -->
        <% if account_page == false %>
          <!-- Compare and Homes for Sale -->
          <div class="hidden-xs col-sm-3 col-md-2 tar pvl">
            <%= render 'compare_schools_compare_button', school: school if @allow_compare %>
            <%= link_to zillow_url(school), class: 'btn btn-default zillow-button clearfix mts db', rel: 'nofollow', target: '_blank' do %>
              <div class="iconx16 i-16-blue-home fl mrs"></div>
              <div class="fl"><%= t('.homes_for_sale') %></div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="col-xs-12 visible-xs clearfix phl pbm font-size-small">
      <div class="fl">
      <% if !school.community_rating.nil? && !school.review_count.nil? %>
        <span class="prm vam"><%= draw_stars_16 school.community_rating %></span>
        <%= link_to t('.reviews', count: school.review_count), school_reviews_page_url, class: 'font-size-small js-reviewCount' %>
      <% else %>
        <em class="js-reviewCount"><%= t('.no_reviews') %></em>
      <% end %>
      </div>
      <% if search_by_location? %>
        <div class="fr js-distance"><%= distance %> <%= t('.miles') %></div>
      <% end %>
    </div>

    <% if account_page == false %>
        <div class="pull-right visible-xs" style="width:150px;">
          <%= render 'compare_schools_compare_button', school: school if @allow_compare %>
        </div>
    <% end %>

  </div>
</div>
