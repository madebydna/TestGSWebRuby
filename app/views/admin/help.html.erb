<% category_placement = CategoryPlacement.new %>
<% category = Category.new %>
<% category.name = 'Table Title' %>
<% category_placement.category = category %>
<% category_placement.id = 1 %>

<% @data = [
  {
    name: 'Alameda High School',
    state: 'CA',
    phone: '123-555-1111',
    score: 9,
    website: nil
  },
  {
    name: 'Lowell High School',
    state: 'CA',
    phone: nil,
    score: 7.25,
    website: nil
  },
  {
    name: 'Lincoln Elementary School',
    state: 'AR',
    phone: '123-555-3333',
    score: 9,
    website: nil
  },
  {
    name: nil,
    state: nil,
    phone: nil,
    score: nil,
    website: nil
  }
] %>


<div class="row">
<div class="leftcolumn col-lg-2 prm">
  <div class="toc"></div>
</div>
<div class="rightcolumn col-lg-10">
<h3>Some example data:</h3>
<%= raw CodeRay.scan(JSON.pretty_unparse(@data), :ruby).div(:line_numbers => :table) %>

<h3>Effects of various JSON configurations on different layouts:</h3>
<br/>

<h4>Configured Table layout</h4>
<br/>

<div class="row pam" style="border-top:1px solid grey;">
  <h5>Minimal config</h5><p>Specify column keys, and the label to use</p>
  <div class="col-lg-5">
    <%
      config = {
        columns: [
          {
            key: 'name',
            label: 'School Name'
          },
          {
            key: 'state',
            label: 'State'
          },
          {
            key: 'phone',
            label: 'Phone'
          },
          {
            key: 'score',
            label: 'Score'
          },
          {
            key: 'website',
            label: 'Website'
          }
        ]
      }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>


<div class="row pam" style="border-top:1px solid grey;">
  <h5>Show columns with no values</h5><p>By default, columns which no values will be hidden. To prevent this, use the always_show flag</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score'
           },
           {
             key: 'website',
             label: 'Website',
             always_show: true
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Set default text (N/A)</h5><p>If you want to customize what the "no value" text will be, use the "default" attribute</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone',
             default: 'N/A'
           },
           {
             key: 'score',
             label: 'Score'
           },
           {
             key: 'website',
             label: 'Website',
             always_show: true,
             default: 'N/A'
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Hide entire columns</h5><p>Specifying a subset of columns:  Just remove the columns you don't want</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name',
             hide_header: true
           },
           {
             key: 'score',
             label: 'Score'
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>


<div class="row pam" style="border-top:1px solid grey;">
  <h5>Hiding a column header</h5><p>Use the hide_header boolean flag on the specific column</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name',
             hide_header: true
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score'
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>


<div class="row pam" style="border-top:1px solid grey;">
  <h5>Hide the table header</h5><p>Use the hide_header flag at the top level:</p>
  <div class="col-lg-5">
    <%
       config = {
         hide_header: true,
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score'
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Formatting columns</h5><p>Specify the format attribute</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score',
             format: 'percent'
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Rounding values</h5><p>Specify the precision (number of decimal places)</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score',
             precision: 0
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Sorting columns</h5><p>Specify the column key and the sort direction</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score'
           }
         ],
         sort: {
           key: 'name',
           direction: 'descending'
         }
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Sorting on more than one column</h5><p>Specify an array of sorts. They will be sorted in the order provided</p>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score'
           }
         ],
         sort: [
           {
             key: 'score',
             direction: 'descending'
           },
           {
             key: 'name',
             direction: 'ascending'
           },
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>



<div class="row pam" style="border-top:1px solid grey;">
  <h5>Null values are always sorted last:</h5>
  <div class="col-lg-5">
    <%
       config = {
         columns: [
           {
             key: 'name',
             label: 'School Name'
           },
           {
             key: 'state',
             label: 'State'
           },
           {
             key: 'phone',
             label: 'Phone'
           },
           {
             key: 'score',
             label: 'Score'
           }
         ],
         sort: {
           key: 'phone',
           direction: 'ascending'
         }
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-7">
    <%= render 'data_layouts/configured_table', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>





<br/>
<h4>Pie Chart layout</h4>
<br/>


<div class="row pam" style="border-top:1px solid grey;">
  <h5>For pie charts, you must specify a chart name and two columns. The first column is used for legend / labels</h5>
  <div class="col-lg-3">
    <%
       config = {
         chart_name: 'overview',
         columns: [
           {
             key: 'name'
           },
           {
             key: 'score'
           }
         ]
       }
    %>
    <% category_placement.layout_config = config.to_json %>

    <%= raw CodeRay.scan(JSON.pretty_unparse(config), :ruby).div(:line_numbers => :table) %>
  </div>
  <div class="col-lg-9">
    <%= render 'data_layouts/pie_chart', category_placement: category_placement, data: @data, category: category %>
  </div>
</div>


<script type="text/javascript">
  $(function() {
    var ToC =
      "<nav role='navigation' class='table-of-contents'>" +
        "<h3>Table of contents:</h3>" +
        "<ul>";

    var newLine, el, title, link;

    $("h5").each(function(index) {

      el = $(this);
      title = el.text();
      if (el.attr("id") == undefined) {
        el.attr("id","item" + index);
      }
      link = "#" + el.attr("id");

      newLine =
        "<li>" +
          "<a href='" + link + "'>" +
          title +
          "</a>" +
          "</li>";

      ToC += newLine;
    });

    ToC += "</ul>" + "</nav>";

    $(".toc").prepend(ToC);
  });
</script>