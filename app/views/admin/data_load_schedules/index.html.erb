<%= render 'nav/topnav' %>
<div class="row limit_width_1200">
  <div class="row pbl">
    <div class="container" style="padding:10px;">
      <h2>Data loads</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <td>State</td>
            <td>Description</td>
            <td>Type</td>
            <td>Year to load</td>
            <td>Released</td>
            <td>Live by</td>
            <td>Live by month</td>
          </tr>
        </thead>
        <tbody>
        <% @loads.each do |load|%>
          <tr>
          <td><%= load.state %></td>
          <td><%= load.description %></td>
          <td><%= load.load_type.titleize %></td>
          <td><%= load.year_to_load %></td>
          <td><%= load.released %></td>
          <td><%= load.live_by %></td>
          <td><%= load.live_by_month %></td>
        </tr>
      <% end %>
        </tbody>
      </table>
      <%= link_to 'Add one', new_admin_data_load_schedule_path %><br>
      <% index = Date::MONTHNAMES.index(Time.now.strftime("%B")) %>
      <% months = Date::MONTHNAMES[(index-2)..(index+2)] %>
      <table class="table table-striped">
        <thead>
          <tr>
            <td>State</td>
            <% months.each do |month| %>
              <% next if month.nil? %>
              <% [1, 15].each do |release| %>
                <td><%= "#{month} #{release}" %></td>
              <% end %>
          <% end %>
          </tr>
        </thead>
        <% @loads.each do |load| %>
          <tr>
          <td><%=load.state%></td>
          <% # want to show next few releases by default %>
          <% months.each do |month| %>
            <% next if month.nil? %>
            <% [1, 15].each do |release| %>
              <% if load.live_by_month == "#{month} #{release}" %>
                <td><%= load.load_type.titleize  %></td>
              <% else %>
                <td></td>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        </tr>
      </table>
    </div>
  </div>
</div>
