<% content_for :page_javascripts do %>
  <%= webpack_javascript_include_tag 'react-redux', defer: true %>
  <%= webpack_javascript_include_tag 'community', defer: true %>
<% end %>
<% content_for :page_stylesheets do %>
  <%= stylesheet_link_tag "community_post_load", async: true %>
  <%= stylesheet_link_tag "city", async: true %>
<% end %>

<% slot_1 = "greatschools_citypagemobile_first" %>
<% slot_2 = "greatschools_citypage_second" %>
<% query = "#{@locality[:city]}-#{@locality[:stateShort]}" %>

<div class="community-page">
  <div class="city-body">
    <%= react_component('SearchBoxWrapper') %>

    <div class="breadcrumbs-container">
      <%= render 'community/breadcrumbs', breadcrumbs: @breadcrumbs %>
    </div>
    <%= render 'cities/hero', city: @locality[:city], state_long: @locality[:stateLong], state_short: @locality[:stateShort], county: @locality[:county] %>


    <div class="below-hero">
      <%= render 'community/toc' %><div class="community-modules">

        <%# First Ad %>
        <div class="display-mobile js-<%= slot_1 %>-height">
          <%= react_component("AdWrapper", props: {
              slot: slot_1
          }) %>
        </div>

        <%# Schools %>
        <div id="schools" class="module-section">
          <h2 class="modules-title"><%= I18n.t('find_schools_in', scope: 'community.city') %> <%= @locality[:city] %></h2>

          <%# School Browse Links (Find schools in city) %>
          <% if @school_levels %>
            <%= react_component("SchoolBrowseLinksWrapper", props: {
                community: 'city',
                locality: @locality,
                schoolLevels: @school_levels
            }) %>
          <% end %>

          <%# Top Schools %>
          <% if @top_schools[:counts][:all] > 0 %>
            <%= react_component("TopSchoolsStatefulWrapper", props: {
                community: 'city',
                schoolsData: @top_schools[:schools],
                locality: @locality,
                schoolLevels: @top_schools[:counts],
                summaryType: @summary_type
            }) %>
          <% end %>
        </div>

        <%# Second Ad %>
        <div id="second-ad" class="js-<%= slot_2 %>-height">
          <%= react_component("AdWrapper", props: {
              slot: slot_2
          }) %>
        </div>

        <%# CSA Generic Module %>
        <% if @top_schools[:schools][:csa].length == 0 && @csa_module %>
          <div>
            <%= react_component("CsaInfo", props: {
                community: 'city',
                locality: @locality
            }) %>
          </div>
        <% end %>

        <%# Districts %>
        <% if @districts.length > 0 %>
          <div id="districts" class="module-section">
            <h2 class="modules-title"><%= I18n.t('districts_header', scope: 'community.city', city: @locality[:city]) %></h2>
            <%= render 'community/districts_in_community',
                  districts: @districts,
                  locality: @locality,
                  pageType: 'city'
            %>
          </div>
        <% end %>

        <%# Mobility %>
        <div id="mobility" class="module-section">
          <h3 class="modules-title"><%= I18n.t('title', scope: 'community.mobility') %> <%= @locality[:city] %></h3>
          <div class="community_resource_module_container">
            <div class="module-header community_resource_module">
              <%= render 'community/nearby_homes_resources', query: query, community: 'city' %>
            </div>

            <div class="module-footer">
              <%= render 'school_profiles/sources_link_to_modal', content: I18n.t('homes_sales.sources', scope: 'community.city') %>
            </div>
          </div>
          <%= react_component("Mobility", props: {
              locality: @locality,
              pageType: 'City'
          }) %>
        </div>

        <%# Reviews %>
        <% if @reviews.length > 0 %>
          <div id="reviews" class="module-section">
            <div class="rating-container reviews-module">
              <h3><%= I18n.t('title', scope: 'community.recent_reviews') %> <%= @locality[:city] %></h3>

              <%= render 'community/recent_reviews',
                    reviews: @reviews,
                    pageType: 'city'
              %>
            </div>
          </div>
        <% end %>

        <%# Neighboring Cities %>
        <% if @neighboring_cities.length > 0 %>
          <div id="neighboring-cities" class="module-section">
            <%= render 'community/city_browse_links',
                  header: 'neighboring_cities',
                  cities: @neighboring_cities,
                  locality: @locality,
                  pageType: 'city'
            %>
          </div>
        <% end %>

      </div><%= render 'community/sticky_right_rail', ad_slot_name: "greatschools_citypage_first" %>
    </div>
  </div>
</div>